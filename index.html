<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TECHSTORE | Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; background: #fff; scroll-behavior: smooth; }
        .product-modal { display: none; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); }
        .category-btn.active { background: #2563eb; color: white; border-color: #2563eb; }
    </style>
</head>
<body class="bg-slate-50">

<header class="bg-white border-b sticky top-0 z-[100] p-4 shadow-sm">
    <div class="container mx-auto flex justify-between items-center">
        <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
            <div class="bg-blue-600 p-2 rounded-lg text-white shadow-lg"><i class="fa fa-bolt"></i></div>
            <h1 class="text-2xl font-black">TECH<span class="text-blue-600">STORE</span></h1>
        </div>
        <div class="flex-1 max-w-md mx-6 hidden md:block">
            <input id="search-bar" oninput="search()" placeholder="ابحث عن الموبايل أو الساعة اللي بتدور عليها..." class="w-full border-2 p-2 rounded-full px-6 outline-none focus:border-blue-500">
        </div>
        <div onclick="toggleCart(true)" class="relative cursor-pointer">
            <i class="fa fa-shopping-bag text-2xl"></i>
            <span id="cart-count" class="absolute -top-2 -right-2 bg-red-600 text-white text-[10px] rounded-full w-4 h-4 flex items-center justify-center font-bold">0</span>
        </div>
    </div>
</header>

<nav class="bg-white border-b overflow-x-auto p-3 sticky top-[73px] z-[90]">
    <div class="container mx-auto flex gap-3">
        <button onclick="filterCat('الكل', this)" class="category-btn active px-6 py-2 rounded-full border font-bold">الكل</button>
        <button onclick="filterCat('موبايلات', this)" class="category-btn px-6 py-2 rounded-full border font-bold">موبايلات</button>
        <button onclick="filterCat('ساعات', this)" class="category-btn px-6 py-2 rounded-full border font-bold">ساعات</button>
        <button onclick="filterCat('شواحن', this)" class="category-btn px-6 py-2 rounded-full border font-bold">شواحن</button>
        <button onclick="filterCat('إكسسوارات', this)" class="category-btn px-6 py-2 rounded-full border font-bold">إكسسوارات</button>
    </div>
</nav>

<main class="container mx-auto p-6 py-12">
    <div id="grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-8"></div>
</main>

<div id="product-details" class="fixed inset-0 z-[200] product-modal flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-4xl rounded-[2.5rem] p-6 md:p-10 relative overflow-y-auto max-h-[90vh]">
        <button onclick="closeDetails()" class="absolute top-5 right-5 text-3xl font-bold">&times;</button>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
            <img id="det-img" class="w-full h-80 object-contain bg-gray-50 rounded-3xl p-4">
            <div class="text-right">
                <span id="det-cat" class="bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-xs font-bold uppercase"></span>
                <h2 id="det-name" class="text-3xl font-black mt-4 mb-2"></h2>
                <div class="flex items-center gap-2 mb-4">
                    <span class="text-yellow-400">★★★★★</span>
                    <span class="text-gray-400 text-xs">(<span id="det-orders">0</span> شخص اشتراه)</span>
                </div>
                <div id="det-price" class="text-2xl font-black text-blue-600 mb-6"></div>
                <p id="det-desc" class="text-gray-500 mb-8 leading-relaxed"></p>
                <button id="add-btn-final" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black text-xl shadow-lg">إضافة للسلة</button>
                
                <div class="mt-10 border-t pt-6">
                    <h3 class="font-bold mb-4">التعليقات</h3>
                    <div id="det-comments" class="space-y-2 mb-4"></div>
                    <div class="flex gap-2">
                        <input id="user-comment" placeholder="اكتب رأيك..." class="flex-1 border p-2 rounded-xl text-sm">
                        <button onclick="sendComment()" class="bg-slate-900 text-white px-4 rounded-xl text-xs">إرسال</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="cart-sidebar" class="fixed top-0 right-0 w-full max-w-md h-full bg-white z-[300] shadow-2xl p-6 hidden flex-col">
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-black italic">طلبك</h2>
        <button onclick="toggleCart(false)" class="text-2xl">&times;</button>
    </div>
    <div id="cart-items" class="flex-1 overflow-y-auto space-y-4"></div>
    <div class="border-t pt-6 space-y-4">
        <div class="flex justify-between text-2xl font-black"><span>الإجمالي:</span> <span id="cart-total">0</span> ج.م</div>
        <div class="bg-gray-50 p-4 rounded-2xl space-y-2">
            <input id="o-name" placeholder="اسمك الكامل" class="w-full border p-2 rounded-lg text-sm">
            <input id="o-phone" placeholder="رقم الموبايل" class="w-full border p-2 rounded-lg text-sm">
            <textarea id="o-addr" placeholder="العنوان (منزل، دور، شقة، منطقة)" class="w-full border p-2 rounded-lg text-sm h-20"></textarea>
        </div>
        <button onclick="confirmOrder()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-black shadow-xl">تأكيد الأوردر (واتساب)</button>
    </div>
</div>

<footer class="bg-slate-900 text-white py-10 text-center mt-20">
    <p class="font-bold">جميع الحقوق محفوظة &copy; 2026 TECHSTORE - لؤي</p>
</footer>

<script>
    const DB = "https://store-c8993-default-rtdb.firebaseio.com/"; // لينك الداتا بيس الجديد
    let products = {}, cart = [], currentID = "";

    async function init() {
        const res = await fetch(DB + "products.json");
        products = await res.json() || {};
        render(products);
    }

    function render(data) {
        document.getElementById('grid').innerHTML = Object.keys(data).map(k => `
            <div class="bg-white p-5 rounded-[2rem] shadow-sm hover:shadow-xl transition-all border text-center flex flex-col justify-between">
                <div onclick="showDet('${k}')" class="cursor-pointer">
                    <img src="${data[k].img}" class="h-40 w-full object-contain mb-4">
                    <h4 class="font-bold text-sm h-10 overflow-hidden">${data[k].name}</h4>
                    <div class="text-blue-600 font-black text-xl mt-3">${data[k].price} ج.م</div>
                </div>
                <button onclick="addToCart('${k}')" class="bg-blue-600 text-white w-full py-2 rounded-xl mt-4 text-xs font-bold shadow-md">إضافة للسلة</button>
            </div>`).join('');
    }

    function showDet(id) {
        currentID = id;
        const p = products[id];
        document.getElementById('det-name').innerText = p.name;
        document.getElementById('det-price').innerText = p.price + " ج.م";
        document.getElementById('det-desc').innerText = p.desc || "لا يوجد وصف حالياً.";
        document.getElementById('det-cat').innerText = p.cat;
        document.getElementById('det-img').src = p.img;
        document.getElementById('det-orders').innerText = p.orderCount || 0;
        document.getElementById('add-btn-final').onclick = () => addToCart(id);
        loadComments(id);
        document.getElementById('product-details').style.display = 'flex';
    }

    function addToCart(id) {
        const p = products[id];
        cart.push({ n: p.name, p: p.price, i: p.img });
        updateCart();
        alert('أضفت المنتج للسلة ✅');
    }

    function updateCart() {
        document.getElementById('cart-count').innerText = cart.length;
        let total = 0;
        document.getElementById('cart-items').innerHTML = cart.map((item, i) => {
            total += parseInt(item.p);
            return `<div class="flex gap-4 items-center bg-gray-50 p-2 rounded-xl"><img src="${item.i}" class="w-12 h-12 object-cover rounded-lg"><div><b class="text-xs">${item.n}</b><br><span class="text-blue-600 text-xs">${item.p} ج.م</span></div></div>`;
        }).join('');
        document.getElementById('cart-total').innerText = total;
    }

    async function confirmOrder() {
        if(cart.length === 0) return alert('السلة فاضية');
        const name = document.getElementById('o-name').value;
        const phone = document.getElementById('o-phone').value;
        const addr = document.getElementById('o-addr').value;
        const total = document.getElementById('cart-total').innerText;
        
        // تجهيز رسالة الواتس
        const itemsMsg = cart.map(i => `- ${i.n} (${i.p} ج.م)`).join('%0A');
        const finalMsg = `طلب جديد من TECHSTORE%0A----------%0Aالاسم: ${name}%0Aالموبايل: ${phone}%0Aالعنوان: ${addr}%0A----------%0Aالمنتجات:%0A${itemsMsg}%0A----------%0Aالإجمالي: ${total} ج.م`;
        
        // إرسال للداتا بيس (عشان تسجل الأوردر عندك)
        await fetch(DB + "orders.json", { method: 'POST', body: JSON.stringify({ name, phone, addr, items: cart, total, date: new Date().toLocaleString() }) });
        
        // فتح الواتساب
        window.open(`https://wa.me/201121189810?text=${finalMsg}`);
        location.reload();
    }

    async function sendComment() {
        const txt = document.getElementById('user-comment').value;
        if(!txt) return;
        await fetch(DB + `products/${currentID}/comments.json`, { method: 'POST', body: JSON.stringify(txt) });
        document.getElementById('user-comment').value = "";
        loadComments(currentID);
    }

    async function loadComments(id) {
        const res = await fetch(DB + `products/${id}/comments.json`);
        const data = await res.json();
        document.getElementById('det-comments').innerHTML = data ? Object.values(data).map(c => `<div class="bg-gray-50 p-2 rounded-xl text-xs font-bold border-r-4 border-blue-500">${c}</div>`).join('') : "لا يوجد تعليقات بعد.";
    }

    function toggleCart(s) { document.getElementById('cart-sidebar').style.display = s ? 'flex' : 'none'; }
    function closeDetails() { document.getElementById('product-details').style.display = 'none'; }
    function filterCat(c, b) {
        document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
        b.classList.add('active');
        if(c === 'الكل') return render(products);
        const filtered = Object.keys(products).filter(k => products[k].cat === c).reduce((r, k) => (r[k] = products[k], r), {});
        render(filtered);
    }

    init();
</script>
</body>
</html>
